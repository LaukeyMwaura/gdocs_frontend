{"ast":null,"code":"import _slicedToArray from\"/home/laukey/Documents/phase 3/g-docs deploy/g-docs/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useState}from\"react\";import Quill from\"quill\";import\"quill/dist/quill.snow.css\";import{io}from\"socket.io-client\";import{useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";var SAVE_INTERVAL_MS=2000;var TOOLBAR_OPTIONS=[[{header:[1,2,3,4,5,6,false]}],[{font:[]}],[{list:\"ordered\"},{list:\"bullet\"}],[\"bold\",\"italic\",\"underline\"],[{color:[]},{background:[]}],[{align:[]}],[\"image\",\"blockquote\",\"code-block\"],[\"clean\"]];function TextEditor(){var _useParams=useParams(),documentId=_useParams.id;var _useState=useState(),_useState2=_slicedToArray(_useState,2),socket=_useState2[0],setSocket=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),quill=_useState4[0],setQuill=_useState4[1];useEffect(function(){var s=io(\"http://localhost:3001\");setSocket(s);return function(){s.disconnect();};},[]);useEffect(function(){if(socket==null||quill==null)return;socket.once(\"load-document\",function(document){quill.setContents(document);quill.enable();});socket.emit('get-document',documentId);},[socket,quill,documentId]);useEffect(function(){if(socket==null||quill==null)return;var interval=setInterval(function(){socket.emit(\"save-document\",quill.getContents());},SAVE_INTERVAL_MS);return function(){clearInterval(interval);};},[socket,quill]);useEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta){quill.updateContents(delta);};socket.on(\"receive-changes\",handler);return function(){socket.off(\"receive-changes\",handler);};},[socket,quill]);useEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta,oldDelta,source){if(source!==\"user\")return;socket.emit(\"send-changes\",delta);};quill.on('text-change',handler);return function(){quill.off('text-change',handler);};},[socket,quill]);var wrapperRef=useCallback(function(wrapper){if(wrapper==null)return;wrapper.innerHTML=\"\";var editor=document.createElement(\"div\");wrapper.append(editor);var q=new Quill(editor,{theme:\"snow\",modules:{toolbar:TOOLBAR_OPTIONS}});q.disable();q.setText('Loading...');setQuill(q);},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"container container-fluid\",ref:wrapperRef});}export default TextEditor;","map":{"version":3,"sources":["/home/laukey/Documents/phase 3/g-docs deploy/g-docs/client/src/TextEditor.js"],"names":["React","useCallback","useEffect","useState","Quill","io","useParams","SAVE_INTERVAL_MS","TOOLBAR_OPTIONS","header","font","list","color","background","align","TextEditor","documentId","id","socket","setSocket","quill","setQuill","s","disconnect","once","document","setContents","enable","emit","interval","setInterval","getContents","clearInterval","handler","delta","updateContents","on","off","oldDelta","source","wrapperRef","wrapper","innerHTML","editor","createElement","append","q","theme","modules","toolbar","disable","setText"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\nimport Quill from \"quill\";\nimport \"quill/dist/quill.snow.css\";\nimport { io } from \"socket.io-client\";\nimport { useParams } from \"react-router-dom\"\n\n\nconst SAVE_INTERVAL_MS = 2000;\n\nconst TOOLBAR_OPTIONS = [\n  [{ header: [1, 2, 3, 4, 5, 6, false] }],\n  [{ font: [] }],\n  [{ list: \"ordered\" }, { list: \"bullet\" }],\n  [\"bold\", \"italic\", \"underline\"],\n  [{ color: [] }, { background: [] }],\n  [{ align: [] }],\n  [\"image\", \"blockquote\", \"code-block\"],\n  [\"clean\"],\n];\n\nfunction TextEditor() {\n  const { id: documentId } = useParams();\n  \n  const [socket, setSocket] = useState();\n\n  const [quill, setQuill] = useState();\n\n\n  \n  useEffect(() => {\n    const s = io(\"http://localhost:3001\");\n    setSocket(s);\n    return () => {\n      s.disconnect();\n    };\n  }, []);\n\n   useEffect(() => {\n    if (socket == null || quill == null) return;\n    socket.once(\"load-document\", document => {\n      quill.setContents(document)\n      quill.enable()\n    })\n\n\n    socket.emit('get-document', documentId)\n\n    },[socket, quill, documentId])\n  \n  useEffect(() => {\n    if (socket == null || quill == null) return;\n\n    const interval = setInterval(() => {\n      socket.emit(\"save-document\", quill.getContents())\n    }, SAVE_INTERVAL_MS)\n\n    return () => {\n      clearInterval(interval)\n    }\n  },[socket, quill])\n\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n\n    const handler = delta => {\n      quill.updateContents(delta);\n    };\n\n    socket.on(\"receive-changes\", handler);\n\n    return () => {\n      socket.off(\"receive-changes\", handler);\n    };\n  }, [socket, quill]);\n\n\n  useEffect(() => {\n    if (socket == null || quill == null) return;\n    \n    const handler = (delta, oldDelta, source) => {\n      if (source !== \"user\") return;\n      socket.emit(\"send-changes\", delta);\n    };\n\n    quill.on('text-change', handler);\n\n    return () => {\n      quill.off('text-change',handler);\n    }\n  },[socket, quill]);\n\n  const wrapperRef = useCallback((wrapper) => {\n    if (wrapper == null) return;\n\n    wrapper.innerHTML = \"\";\n    const editor = document.createElement(\"div\");\n\n    wrapper.append(editor);\n\n    const q = new Quill(editor, { theme: \"snow\", modules: { toolbar: TOOLBAR_OPTIONS } });\n    q.disable()\n    q.setText('Loading...')\n    setQuill(q)\n  }, []);\n  return <div className=\"container container-fluid\" ref={wrapperRef}></div>;\n}\n\nexport default TextEditor;\n"]},"metadata":{},"sourceType":"module"}